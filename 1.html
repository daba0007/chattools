<!DOCTYPE html>
<html>
<head>
    <title>Example</title>
</head>
<body>
    <input type="text" id="input" />
    <button onclick="send()">发送</button>
    <div id="output"></div>

    <script>
        async function send() {
        const input = document.getElementById("input").value;
        const output = document.getElementById("output");
        output.innerText = "";
        const url = "https://xsre.workflow.sz.shopee.io/chat/completions";
        const data = {"max_tokens": 2048, "top_p": 0.2, "temperature": 0.8, "mix":true, "messages": [{"role":"user", "content":input}]};
        const eventSource = new EventSource('https://xsre.workflow.sz.shopee.io/chat/completions');
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => response.text())
        .then(text => {
            const decodedText = decodeURIComponent(escape(text));
            output.innerText = decodedText;
        });
        /* const response = await fetch(url, {
            method: "POST",
            body: JSON.stringify(data),
            headers: {
                "Content-Type": "application/json"
            }
        })
        //获取UTF8的解码
        const encode = new TextDecoder("utf-8");
        //获取body的reader
        const reader = response.body.getReader();
        // 循环读取reponse中的内容
        while (true) {
            const { done, value } = await reader.read();
            if (done) {
                break;
            }
            // 解码内容
            const text = encode.decode(value);
            // 当获取错误token时，输出错误信息
            if (text === "<ERR>") {
                output.innerText = "Error";
                break;
            } else {
                // 获取正常信息时，逐字追加输出
                let jsonString = text.replace(/[^a-zA-Z0-9{} [],":.]/g, '');
                let msg = JSON.parse(jsonString)
                output.innerText = msg.response;
            }
        } */
    }
    </script>
</body>
</html>